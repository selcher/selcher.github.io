/**
 * canvas-app - v0.0.1 - build 2015-04-18 15:04:40
 * Copyright (c) 2014-2015 Selcher;
 * Distributed under the terms of the MIT license.
 */
function CanvasCrop(a){if(this instanceof CanvasCrop){var b=document;return this.app=a,this.canvas=a.canvas,this.container=b.getElementById("cropDiv"),this.menu=b.getElementById("cropDivMenu"),this.currentImg=new Image,this.jcropApi=null,this.cropX=b.getElementById("x"),this.cropY=b.getElementById("y"),this.cropW=b.getElementById("w"),this.cropH=b.getElementById("h"),this.dstX=null,this.dstY=null,this.dstW=null,this.dstH=null,this.cropBoxContainer=b.getElementById("cropboxContainer"),this.cropBox=b.getElementById("cropbox"),this.cropImgPreviewContainer=b.getElementById("imgCont"),this.cropPreview=b.getElementById("cropPreview"),this.generatedCropContainer=b.getElementById("collageCropContainer"),this.generatedCropCanvas=b.getElementById("collageCrop"),this.cropBoxFormContainer=$("#cropboxFormContainer"),this.collageCropCanvasContainer=$("#collageCropCanvasContainer"),this.showCropDivBtn=b.getElementById("cropBtn"),this.hideCropDivBtn=b.getElementById("closeCrop"),this.showCropBoxBtn=b.getElementById("cropImgBtn"),this.showCropImgBtn=b.getElementById("generateCropImgBtn"),this.addToCanvasBtn=b.getElementById("addCropToCanvas"),this.saveCropImgBtn=b.getElementById("saveCrop"),this.topMenu=b.getElementById("topMenu"),this.canvasCont=b.getElementById("canvasCont"),this.toolbar=b.getElementById("toolbar"),this}return new CanvasCrop(a)}function callSuper(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,slice.call(arguments,1)):b.call(this)}function createCanvasElement(a){return a||(a=fabric.document.createElement("canvas")),a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a}function createClass(){function a(){this.initialize.apply(this,arguments)}var b=null,c=slice.call(arguments,0);"function"==typeof c[0]&&(b=c.shift()),a.superclass=b,a.subclasses=[],b&&(Subclass.prototype=b.prototype,a.prototype=new Subclass,b.subclasses.push(a));for(var d=0,e=c.length;e>d;d++)addMethods(a,c[d],b);return a.prototype.initialize||(a.prototype.initialize=emptyFunction),a.prototype.constructor=a,a.prototype.callSuper=callSuper,a}function CanvasAppSidebar(a){return this instanceof CanvasAppSidebar?(this.app=a,this):new CanvasAppSidebar(a)}function CanvasAppToolbar(a){return this instanceof CanvasAppToolbar?(this.app=a,this):new CanvasAppToolbar(a)}function CanvasApp(a){return this instanceof CanvasApp?(this.canvas=a,this.bgColor="#000000",this.color="#66FF00",this.colorTxt="#66FF00",this.image=new Image,this.canvasObj={images:{},imagesCount:1,shapes:{},shapesCount:1,texts:{},textsCount:1,imgCrop:{},imgCropCount:1},this.toolbar=null,this.sidebar=this,this):new CanvasApp}CanvasCrop.prototype.init=function(){this.initHandlers()},CanvasCrop.prototype.initHandlers=function(){var a=this,b=function(){var b=$("#cropDiv").height()-20;a.cropBoxFormContainer.height(b),a.collageCropCanvasContainer.height(b)},c=function(){var b=$("#cropDiv").height()-40;a.cropBoxFormContainer.height(b),a.collageCropCanvasContainer.height(b)};window.onresize=function(){c()},this.showCropDivBtn.onclick=function(){b(),a.topMenu.style.display="none",a.canvasCont.style.display="none",a.toolbar.style.display="none",a.displayCropDiv(),a.showCropBoxContainer(),a.hideGeneratedCropContainer()},this.hideCropDivBtn.onclick=function(){a.topMenu.style.display="block",a.canvasCont.style.display="block",a.toolbar.style.display="block",a.hideCropDiv()},this.showCropBoxBtn.onclick=function(){a.showCropBoxContainer(),a.hideGeneratedCropContainer()},this.showCropImgBtn.onclick=function(){a.hideCropBoxContainer(),a.showGeneratedCropContainer(),a.generateCropCanvas()},this.addToCanvasBtn.onclick=function(){a.addCropToCanvas(),a.app.sidebar.openList()},this.saveCropImgBtn.onclick=function(){a.saveCrop()}},CanvasCrop.prototype.initJcrop=function(a){var b=this;this.jcropApi&&this.jcropApi.destroy(),this.cropBox.src=a,this.cropPreview.src=a,$("#cropbox").Jcrop({onChange:this.showPreview.bind(this),onSelect:this.showPreview.bind(this)},function(){b.jcropApi=this}),this.currentImg.src=a},CanvasCrop.prototype.displayCropDiv=function(){var a=this.container,b=a.style.display;("none"===b||""===b)&&(a.style.display="block",this.menu.style.display="block")},CanvasCrop.prototype.hideCropDiv=function(){var a=this.container,b=a.style.display;"block"==b&&(a.style.display="none",this.menu.style.display="none")},CanvasCrop.prototype.showCropBoxContainer=function(){this.cropBoxContainer.style.display="block",this.showCropImgBtn.style.display="inline-block"},CanvasCrop.prototype.hideCropBoxContainer=function(){this.cropBoxContainer.style.display="none",this.showCropImgBtn.style.display="none"},CanvasCrop.prototype.showGeneratedCropContainer=function(){this.generatedCropContainer.style.display="block",this.showCropBoxBtn.style.display="inline-block",this.addToCanvasBtn.style.display="inline-block",this.saveCropImgBtn.style.display="inline-block"},CanvasCrop.prototype.hideGeneratedCropContainer=function(){this.generatedCropContainer.style.display="none",this.showCropBoxBtn.style.display="none",this.addToCanvasBtn.style.display="none",this.saveCropImgBtn.style.display="none"},CanvasCrop.prototype.showPreview=function(a){this.cropX.value=a.x,this.cropY.value=a.y,this.cropW.value=a.w,this.cropH.value=a.h;var b=this.cropImgPreviewContainer;b.style.width=a.w,b.style.height=a.h;var c=this.cropBox.width,d=this.cropBox.height,e=1,f=1;$("#cropPreview").css({width:e*c+"px",height:f*d+"px",marginLeft:"-"+Math.round(e*a.x)+"px",marginTop:"-"+Math.round(f*a.y)+"px"})},CanvasCrop.prototype.generateCropCanvas=function(){var a=this.cropBox;this.generatedCropCanvas.width=this.cropW.value,this.generatedCropCanvas.height=this.cropH.value;var b=this.generatedCropCanvas,c=b.getContext("2d"),d=new Image;d.onload=function(){var e=parseInt(this.cropX.value),f=parseInt(this.cropY.value),g=parseInt(this.cropW.value),h=parseInt(this.cropH.value),i=g,j=h,k=b.width/2-i/2,l=b.height/2-j/2;c.drawImage(d,e,f,g,h,k,l,i,j);var m=a.width/2,n=a.height/2;this.dstX=-m,this.dstY=-n,this.dstW=i,this.dstH=j,m>e&&(this.dstX=-(m-e)),e>m&&(this.dstX=m-e),n>f&&(this.dstY=-(n-f)),f>n&&(this.dstY=n-f)}.bind(this),d.src=a.src},CanvasCrop.prototype.addCropToCanvas=function(){this.addCropImg(this.dstX,this.dstY,this.dstW,this.dstH)},CanvasCrop.prototype.addCropImg=function(a,b,c,d){var e=this.app.canvasObj,f=e.imgCrop,g=e.imgCropCount,h=this.currentImg,e=this.app.canvasObj,g=e.imgCropCount,i="cropImg"+g,j='<img id="'+i+'" src="'+h.src+'" />';$("#cropImgsCont").append(j);var k=document.getElementById(i);f[g]={id:i,src:k.src,img:new fabric.Image(k,{left:100,top:100,angle:0,opacity:1,clipTo:function(e){e.rect(a,b,c,d)}})},this.canvas.add(f[g].img),this.app.canvasObj.imgCropCount+=1,this.app.sidebar.updateList()},CanvasCrop.prototype.saveCrop=function(){{var a=this.generatedCropCanvas;a.getContext("2d")}a.toBlob(function(a){saveAs(a,"crop.png")})};var slice=Array.prototype.slice,IS_DONTENUM_BUGGY=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),addMethods=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],IS_DONTENUM_BUGGY&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createCanvasElement=createCanvasElement,fabric.util.createClass=createClass,fabric.Image.filters.Convolute=fabric.util.createClass({type:"Convolute",initialize:function(a){a||(a={}),this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];var b=fabric.util.createCanvasElement();this.tmpCtx=b.getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){for(var b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=Math.round(Math.sqrt(b.length)),f=Math.floor(e/2),g=d.data,h=d.width,i=d.height,j=h,k=i,l=this._createImageData(j,k),m=l.data,n=this.opaque?1:0,o=0;k>o;o++)for(var p=0;j>p;p++){for(var q=o,r=p,s=4*(o*j+p),t=0,u=0,v=0,w=0,x=0;e>x;x++)for(var y=0;e>y;y++){var z=q+x-f,A=r+y-f;if(z>=0&&i>z&&A>=0&&h>A){var B=4*(z*h+A),C=b[x*e+y];t+=g[B]*C,u+=g[B+1]*C,v+=g[B+2]*C,w+=g[B+3]*C}}m[s]=t,m[s+1]=u,m[s+2]=v,m[s+3]=w+n*(255-w)}c.putImageData(l,0,0)},toJSON:function(){return{type:this.type,matrix:this.matrix}}}),CanvasAppSidebar.prototype.init=function(){this.initHandlers()},CanvasAppSidebar.prototype.initHandlers=function(){var a=this,b=!0,c=function(){b&&(b=!0,a.resetImgList())};document.getElementById("imgFile").addEventListener("change",c),document.getElementById("addShape").addEventListener("click",c),document.getElementById("addText").addEventListener("click",c),$("#imgList").on("click",".listCont",function(b){b.stopPropagation();var c=$(this).attr("data-index"),d=$(this).attr("data-type");a.selectObj(c,d)}),$("#imgList").on("click",".liCheckBox",function(b){b.stopPropagation();var c=$(this).attr("data-index"),d=$(this).attr("data-type");a.hideObj(c,d)}),$("#imgList").on("click",".listRemoveCanvasObj",function(b){b.stopPropagation();var c=$(this).attr("data-index"),d=$(this).attr("data-type");a.removeObj(c,d.toLowerCase()),a.app.removeObj(c,d.toLowerCase())})},CanvasAppSidebar.prototype.openList=function(){var a=$("#sidebar-panel");1===a.accordion("option","active")&&a.accordion("option","active",0)},CanvasAppSidebar.prototype.resetImgList=function(){document.getElementById("imgList").html=""},CanvasAppSidebar.prototype.updateList=function(){var a="",b=this.app,c=b.canvasObj,d=c.images,e=c.shapes,f=c.texts,g=c.imgCrop;null!=d[0]&&(a=this.getListDiv(0,"Img","BG"));for(i in d)0!=i&&(a+=this.getListDiv(i,"Img","Img_"+i));for(i in e)0!=i&&(a+=this.getListDiv(i,"Shp","Shp_"+i));for(i in f)0!=i&&(a+=this.getListDiv(i,"Txt","Txt_"+i));for(i in g)a+=this.getListDiv(i,"Crp","Crp_"+i);document.getElementById("imgList").innerHTML=a},CanvasAppSidebar.prototype.getListDiv=function(a,b,c){var d=this.app,e=d.canvasObj,f=e.images,g=e.imgCrop,h="Img"==b?"<img class='liImg' src="+f[a].src+" />":"";h="Crp"==b?"<img class='liImg' src="+g[a].src+" />":h;var i=b.toLowerCase()[0]+a;return"<div class='listCont' id='"+b.toLowerCase()+a+"' data-index='"+a+"' data-type='"+b.toLowerCase()+"' ><input class='liCheckBox' id='"+i+"' type='checkbox' data-index='"+a+"' data-type='"+b.toLowerCase()+"' checked='checked'></input><div class='liImgDiv'>"+h+"</div><div class='liTxt'>&nbsp;"+c+"&nbsp;</div><div class='listRemoveCanvasObj' src='img/icons/0006_cross.png' data-index='"+a+"' data-type='"+b+"' ></div></div><div class='clrFloat'></div>"},CanvasAppSidebar.prototype.selectObj=function(a,b){var c=this.app,d=c.canvas,e=c.canvasObj,f="img"==b?e.images:null;f="shp"==b?e.shapes:f,f="txt"==b?e.texts:f,f="crp"==b?e.imgCrop:f;var g=d.getActiveObject(),h=!f[a]||"img"!=b&&"crp"!=b?f[a]:f[a].img;h&&g!=h&&(d.setActiveObject(h),this.clearSelection(),$("#"+b+a).hasClass("selectedList")||$("#"+b+a).addClass("selectedList"))},CanvasAppSidebar.prototype.hideObj=function(a,b){var c=this.app,d=c.canvas,e=c.canvasObj,f="img"==b?e.images:null;f="shp"==b?e.shapes:f,f="txt"==b?e.texts:f,f="crp"==b?e.imgCrop:f;var g=!f[a]||"img"!=b&&"crp"!=b?f[a]:f[a].img,h="img"==b?"i"+a:"";h="shp"==b?"s"+a:h,h="txt"==b?"t"+a:h,h="crp"==b?"c"+a:h,"img"!=b||0!=a&&"img"==b?(g.set("opacity",0),document.getElementById(h).checked&&g.set("opacity",1)):(d.setBackgroundImage("",d.renderAll.bind(d)),document.getElementById(h).checked&&d.setBackgroundImage(f[0].src,d.renderAll.bind(d))),d.renderAll()},CanvasAppSidebar.prototype.removeObj=function(a,b){document.getElementById("imgList").removeChild(document.getElementById(b+a))},CanvasAppSidebar.prototype.clearSelection=function(){$(".listCont").removeClass("selectedList")},CanvasAppToolbar.prototype.init=function(){this.initHandlers()},CanvasAppToolbar.prototype.initHandlers=function(){this.initCanvasSizeHandlers(),this.initNewToolbarHandlers(),this.initEditTabHandler(),this.initSaveTabHandler()},CanvasAppToolbar.prototype.initCanvasSizeHandlers=function(){var a=this;document.getElementById("canvas_size").onchange=function(){var b=$("#canvas_size option:selected").val();b=b.split("x");var c=parseInt(b[0]),d=parseInt(b[1]);a.app.canvas.setWidth(c),a.app.canvas.setHeight(d),a.app.canvas.calcOffset(),$("#canvasCont").height(d+1),$("#sidebarCont").height(d+1)}},CanvasAppToolbar.prototype.initNewToolbarHandlers=function(){var a=this,b=!1,c=a.app,d=c.sidebar;document.getElementById("imgFile").addEventListener("change",function(){b||(b=!0,$("#toolbar_addImg").show()),c.getImageWithPreview(this)}),document.getElementById("addImage").addEventListener("click",function(){c.addImage(),d.openList()}),document.getElementById("setBkGnd").onclick=function(){c.setBackGround(),d.openList()},document.getElementById("colorShape").onchange=function(){c.setColor("#"+this.color)},document.getElementById("addShape").addEventListener("click",function(){c.addShape(),d.openList()}),document.getElementById("colorText").onchange=function(){c.setColorTxt("#"+this.color)},document.getElementById("addText").addEventListener("click",function(){c.addText(),d.openList()}),document.getElementById("bgColorVal").onchange=function(){c.setBgColor("#"+this.color)},document.getElementById("setBgColor").onclick=function(){c.updateCanvasBgColor(),d.openList()}},CanvasAppToolbar.prototype.initEditTabHandler=function(){var a=this;document.getElementById("mvUp").onclick=function(){a.app.moveUp()},document.getElementById("mvBk").onclick=function(){a.app.moveBack()},document.getElementById("strtn").onclick=function(){a.app.strtCanvasObj()},document.getElementById("grayscale").onclick=function(){a.app.editCanvasObj(this,0,new fabric.Image.filters.Grayscale)},document.getElementById("invert").onclick=function(){a.app.editCanvasObj(this,1,new fabric.Image.filters.Invert)},document.getElementById("flipx").onclick=function(){a.app.flip("X")},document.getElementById("flipy").onclick=function(){a.app.flip("Y")};var b=document.getElementById("remove-white"),c=document.getElementById("remove-white-threshold"),d=document.getElementById("remove-white-distance");document.getElementById("remove-white").onclick=function(){var b=parseInt(c.value,10),e=parseInt(d.value,10);a.app.editCanvasObj(this,2,new fabric.Image.filters.RemoveWhite({threshold:b,distance:e}))},document.getElementById("remove-white-threshold").onchange=function(){var e=b.checked,f=parseInt(c.value,10),g=parseInt(d.value,10);a.app.updateCanvasObjProp(e,2,new fabric.Image.filters.RemoveWhite({threshold:f,distance:g}))},document.getElementById("remove-white-distance").onchange=function(){var e=b.checked,f=parseInt(c.value,10),g=parseInt(d.value,10);a.app.updateCanvasObjProp(e,2,new fabric.Image.filters.RemoveWhite({threshold:f,distance:g}))},document.getElementById("sepia").onclick=function(){a.app.editCanvasObj(this,3,new fabric.Image.filters.Sepia)},document.getElementById("sepia2").onclick=function(){a.app.editCanvasObj(this,4,new fabric.Image.filters.Sepia2)};var e=document.getElementById("brightness"),f=document.getElementById("brightness-value");document.getElementById("brightness").onclick=function(){var b=parseInt(f.value,10);a.app.editCanvasObj(this,5,new fabric.Image.filters.Brightness({brightness:b}))},document.getElementById("brightness-value").onchange=function(){var b=e.checked,c=parseInt(e.value,10);a.app.updateCanvasObjProp(b,5,new fabric.Image.filters.Brightness({brightness:c}))};var g=document.getElementById("noise"),h=document.getElementById("noise-value");document.getElementById("noise").onclick=function(){var b=parseInt(h.value,10);a.app.editCanvasObj(this,6,new fabric.Image.filters.Noise({noise:b}))},document.getElementById("noise-value").onchange=function(){var b=g.checked,c=parseInt(h.value,10);a.app.updateCanvasObjProp(b,6,new fabric.Image.filters.Noise({noise:c}))};var i=document.getElementById("gradient-transparency"),j=document.getElementById("gradient-transparency-value");document.getElementById("gradient-transparency").onclick=function(){var b=parseInt(j.value,10);a.app.editCanvasObj(this,7,new fabric.Image.filters.GradientTransparency({threshold:b}))},document.getElementById("gradient-transparency-value").onchange=function(){var b=i.checked,c=parseInt(j.value,10);a.app.updateCanvasObjProp(b,7,new fabric.Image.filters.GradientTransparency({threshold:c}))},document.getElementById("blur").onclick=function(){a.app.editCanvasObj(this,8,new fabric.Image.filters.Convolute({matrix:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]}))},document.getElementById("sharpen").onclick=function(){a.app.editCanvasObj(this,9,new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))},document.getElementById("emboss").onclick=function(){a.app.editCanvasObj(this,10,new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))},document.getElementById("opacity-value").onchange=function(){a.app.setProp("opacity",this.value)},document.getElementById("angle-value").onchange=function(){a.app.setProp("angle",this.value)},document.getElementById("scale-value").onchange=function(){var b=this.value;a.app.setProp("scaleX",b),a.app.setProp("scaleY",b)},document.getElementById("colorFill").onchange=function(){a.app.setProp("fill","#"+this.color)}},CanvasAppToolbar.prototype.initSaveTabHandler=function(){var a=this;document.getElementById("saveTab").onclick=function(){a.updatePreview()},document.getElementById("saveImage").onclick=function(){a.app.saveImage()},document.getElementById("refreshImage").onclick=function(){a.updatePreview()}},CanvasAppToolbar.prototype.updatePreview=function(){document.getElementById("savePreview").src=document.getElementById("collage").toDataURL("image/png")},CanvasApp.prototype.init=function(){this.canvas.backgroundColor=this.bgColor,this.canvas.renderAll(),this.createObjects(),this.initObjects(),this.initHandlers()},CanvasApp.prototype.createObjects=function(){this.toolbar=new CanvasAppToolbar(this),this.sidebar=new CanvasAppSidebar(this),this.crop=new CanvasCrop(this)},CanvasApp.prototype.initObjects=function(){this.toolbar.init(),this.sidebar.init(),this.crop.init()},CanvasApp.prototype.initHandlers=function(){this.initFabricCanvasHandlers()},CanvasApp.prototype.initFabricCanvasHandlers=function(){var a=this,b=this.canvas,c=this.canvasObj,d=c.images,e=c.shapes,f=c.texts,g=c.imgCrop,h=this.sidebar;fabric.util.addListener(fabric.document,"dblclick",function(){var a=b.getActiveObject();if(a)for(i in f)if(f[i]==a){var c=prompt("Enter new text:","text");c&&(f[i].setText(c),b.renderAll())}}),this.canvas.on("object:selected",function(){var b=a.canvas.getActiveObject(),c=null;h.clearSelection();for(i in d)d[i]&&d[i].img==b&&(c=$("#img"+i),c.hasClass("selectedList")||c.addClass("selectedList"));for(i in e)e[i]==b&&(c=$("#shp"+i),c.hasClass("selectedList")||c.addClass("selectedList"));for(i in f)f[i]==b&&(c=$("#txt"+i),c.hasClass("selectedList")||c.addClass("selectedList"));for(i in g)g[i].img==b&&(c=$("#crp"+i),c.hasClass("selectedList")||c.addClass("selectedList"))}),this.canvas.on("selection:cleared",function(){h.clearSelection()})},CanvasApp.prototype.setColor=function(a){this.color=a},CanvasApp.prototype.setColorTxt=function(a){this.colorTxt=a},CanvasApp.prototype.setBgColor=function(a){this.bgColor=a},CanvasApp.prototype.showLoading=function(){$("#loadIndicator").show()},CanvasApp.prototype.hideLoading=function(){$("#loadIndicator").hide()},CanvasApp.prototype.updateCanvas=function(){this.canvas.renderAll()},CanvasApp.prototype.updateCanvasBgColor=function(){this.canvas.backgroundColor=this.bgColor,this.updateCanvas()},CanvasApp.prototype.getImageWithPreview=function(a,b,c){b=b||100,c=c||63;var d=this;if(a.files&&a.files[0]){this.showLoading();var e=new FileReader;e.onload=function(a){d.image.src=a.target.result,$("#imgPreview").attr("src",a.target.result).width(b).height(c),d.crop.initJcrop(a.target.result)},setTimeout(function(){e.readAsDataURL(a.files[0]),d.hideLoading()},10)}},CanvasApp.prototype.addImage=function(){var a=this,b=this.image.src,c=this.canvasObj,d=c.images,e=c.imagesCount,f=this.sidebar,g=this.toolbar;this.showLoading(),setTimeout(function(){setTimeout(function(){fabric.Image.fromURL(b,function(g){d[e]={src:null,img:null,id:e},d[e].src=b,d[e].img=g,c.imagesCount=e+1,g.filters[0]=null,g.applyFilters(a.canvas.renderAll.bind(a.canvas)),a.canvas.add(g),f.updateList()})},0),setTimeout(function(){g.updatePreview(),a.hideLoading()},10)},10)},CanvasApp.prototype.removeObj=function(a,b){var c=this.canvas,d=this.canvasObj,e="img"==b?d.images:null;e="shp"==b?d.shapes:e,e="txt"==b?d.texts:e,e="crp"==b?d.imgCrop:e;var f=!e[a]||"img"!=b&&"crp"!=b?e[a]:e[a].img;"img"!=b||"img"==b&&0!=a?c.remove(f):(c.setBackgroundImage(""),c.backgroundColor="#FFFFFF",c.renderAll()),delete e[a]},CanvasApp.prototype.setBackGround=function(){var a=this,b=this.canvas,c=this.image,d=c.src,e=this.canvasObj,f=e.images;this.showLoading(),setTimeout(function(){setTimeout(function(){b.setBackgroundImage(d,b.renderAll.bind(b))},10),setTimeout(function(){fabric.Image.fromURL(d,function(b){f[0]={src:null,img:null},f[0].src=d,f[0].img=b,a.sidebar.updateList()})},10),setTimeout(function(){a.toolbar.updatePreview(),a.hideLoading()},20)},0)},CanvasApp.prototype.addShape=function(){var a=this.canvasObj,b=a.shapes,c=a.shapesCount,d=document.querySelector("input[name=shape]:checked").value;"circle"==d&&(b[c]=new fabric.Circle({radius:10,fill:this.color,left:100,top:100})),"rectangle"==d&&(b[c]=new fabric.Rect({left:100,top:100,fill:this.color,width:20,height:20})),"triangle"==d&&(b[c]=new fabric.Triangle({width:20,height:30,fill:this.color,left:50,top:50})),void 0!==d&&(this.canvas.add(b[c]),a.shapesCount=c+1,this.sidebar.updateList())},CanvasApp.prototype.addText=function(){var a=$("#fontFamily option:selected").val(),b=$("#fontDecor option:selected").val(),c=this.canvas,d=this.canvasObj,e=d.texts,f=d.textsCount;e[f]=new fabric.Text("text",{left:100,top:100,fill:this.colorTxt,fontFamily:a,textDecoration:b}),c.add(e[f]),this.canvasObj.textsCount=f+1,this.sidebar.updateList()},CanvasApp.prototype.moveUp=function(){var a=this.canvas,b=a.getActiveObject();a.bringForward(b),this.toolbar.updatePreview()},CanvasApp.prototype.moveBack=function(){var a=this.canvas,b=a.getActiveObject();a.sendBackwards(b),this.toolbar.updatePreview()},CanvasApp.prototype.strtCanvasObj=function(){var a=this.canvas,b=a.getActiveObject();b.straighten(),a.renderAll()},CanvasApp.prototype.editCanvasObj=function(a,b,c){var d=this,e=this.canvas,f=e.getActiveObject();f&&f.filters&&(this.showLoading(),null==f.filters[b]?a.checked&&(f.filters[b]=c):a.checked||(f.filters[b]=null),setTimeout(function(){f.applyFilters(e.renderAll.bind(e)),d.hideLoading()},10))},CanvasApp.prototype.updateCanvasObjProp=function(a,b,c){var d=this,e=this.canvas,f=e.getActiveObject();f&&f.filters&&(this.showLoading(),a&&(f.filters[b]=c),setTimeout(function(){f.applyFilters(e.renderAll.bind(e)),d.hideLoading()},10))},CanvasApp.prototype.setProp=function(a,b){var c=this.canvas,d=c.getActiveObject();d&&(d.set(a,b),c.renderAll())},CanvasApp.prototype.flip=function a(b){var c=this.canvas,d=c.getActiveObject(),a=d.get("flip"+b);d&&(a?d.set("flip"+b,!1):d.set("flip"+b,!0),c.renderAll())},CanvasApp.prototype.saveImage=function(){{var a=document.getElementById("collage");a.getContext("2d")}a.toBlob(function(a){saveAs(a,"canvas.png")})},$(document).ready(function(){$("#toolbar").tabs(),$(document).tooltip(),$("#sidebar-panel").accordion({active:1}),$("#toolbar_addImg").hide();var a=new CanvasApp(new fabric.Canvas("collage"));a.init()});